# Faceted Search

This story demonstrates the `useFacets` composable and its associated components. It showcases how to set up a faceted search interface with automatic facet generation, searching, sorting, and filtering.

```html
<script setup>
  import { ref } from 'vue';
  import { useFacets, UluFacetsSidebarLayout, UluFacetsSearch, UluFacetsSort, UluFacetsFilterLists, UluFacetsResults } from '@ulu/frontend-vue'; // Adjust import path
  import { mockItems } from './_mock-data';

  const allItems = ref(mockItems);

  // 1. Define fields for automatic facet generation
  // Use 'getValue' for custom logic, like extracting the year from a Date object.
  const facetFields = [
    { name: 'Category', uid: 'category', open: true, multiple: true }, // Set `multiple: true` for checkbox behavior
    { name: 'Author', uid: 'author', open: true }, // Defaults to single-select (radio)
    { name: 'Year', uid: 'date', open: true, getValue: item => item.date.getFullYear() } // Defaults to single-select (radio)
  ];

  // 2. Define any extra sort types
  const extraSortTypes = {
    newest: { text: 'Date (Newest)', sort: (items) => [...items].sort((a, b) => b.date - a.date) },
    oldest: { text: 'Date (Oldest)', sort: (items) => [...items].sort((a, b) => a.date - b.date) }
  };

  // 3. Initialize the composable with new options
  const {
    facets,
    searchValue,
    selectedSort,
    sortTypes,
    displayItems,
    handleFacetChange, // Use the built-in handler
    clearFilters
  } = useFacets(allItems, {
    facetFields,
    extraSortTypes,
    initialSortType: 'newest',
    searchOptions: { keys: ['title', 'description'] }
  });
</script>

<template>
  <UluFacetsSidebarLayout>
    <template #header>
      <div>
        <h2>Found {{ displayItems.length }} items</h2>
        <UluFacetsSort v-model="selectedSort" :sort-types="sortTypes" />
      </div>
    </template>
    <template #sidebar>
      <UluFacetsSearch v-model="searchValue" placeholder="Search articles..." />
      <div>
        <h3>Filters</h3>
        <button v-if="facets.some(f => f.selectedCount > 0)" @click="clearFilters">Clear</button>
      </div>
      <UluFacetsFilterLists :facets="facets" @facet-change="handleFacetChange" :max-visible="5" />
    </template>
    <template #main>
      <UluFacetsResults :items="displayItems">
        <template #item="{ item }">
          <div>
            <h3>{{ item.title }}</h3>
            <p>{{ item.description }}</p>
            <small>By {{ item.author.join(', ') }}</small><br/>
            <small>Published on: {{ item.date.toLocaleDateString() }}</small>
          </div>
        </template>
        <template #empty>
          <div>
            <p>No matching items found. Try clearing some filters.</p>
          </div>
        </template>
      </UluFacetsResults>
    </template>
  </UluFacetsSidebarLayout>
</template>
```
