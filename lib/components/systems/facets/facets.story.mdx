# Faceted Search

This story demonstrates the `useFacets` composable and its associated components. It showcases how to set up a faceted search interface with automatic facet generation, searching, sorting, and filtering. For detailed configuration options, see the [`facetFields` API reference](#facetfields-api) below the example.

```html
<script setup>
  import { ref } from 'vue';
  import { useFacets } from './useFacets.js';
  import UluFacetsFilterAccordions from './UluFacetsFilterAccordions.vue';
  import UluFacetsResults from './UluFacetsResults.vue';
  import UluFacetsSearch from './UluFacetsSearch.vue';
  import UluFacetsSort from './UluFacetsSort.vue';
  import UluFacetsSidebarLayout from './UluFacetsSidebarLayout.vue';
  import { mockItems } from './_mock-data';

  const allItems = ref(mockItems);

  // 1. Define fields for automatic facet generation
  const facetFields = [
    { name: 'Category', uid: 'category', open: true, multiple: true },
    { name: 'Author', uid: 'author', open: true },
    { name: 'Year', uid: 'date', open: true, getValue: item => item.date.getFullYear() }
  ];

  // 2. Define any extra sort types
  const extraSortTypes = {
    newest: { text: 'Date (Newest)', sort: (items) => [...items].sort((a, b) => b.date - a.date) },
    oldest: { text: 'Date (Oldest)', sort: (items) => [...items].sort((a, b) => a.date - b.date) }
  };

  // 3. Initialize the composable
  const {
    facets,
    searchValue,
    selectedSort,
    sortTypes,
    displayItems,
    selectedFacets, // Use this to check if filters are active
    handleFacetChange,
    clearFilters
  } = useFacets(allItems, {
    facetFields,
    extraSortTypes,
    initialSortType: 'newest',
    countMode: 'intuitive', // Show counts next to facet values
    searchOptions: { keys: ['title', 'description', 'author'] }
  });
</script>

<template>
  <UluFacetsSidebarLayout>
    <template #header>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #eee;">
        <h2>Found {{ displayItems.length }} items</h2>
        <UluFacetsSort v-model="selectedSort" :sort-types="sortTypes" />
      </div>
    </template>
    <template #sidebar>
      <UluFacetsSearch v-model="searchValue" placeholder="Search articles..." />
      <hr/>
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h3>Filters</h3>
        <button v-if="selectedFacets.length > 0" @click="clearFilters" style="border: none; background: none; color: blue; cursor: pointer;">Clear</button>
      </div>
      <UluFacetsFilterAccordions :facets="facets" @facet-change="handleFacetChange" :max-visible="5" />
    </template>
    <template #main>
      <UluFacetsResults :items="displayItems">
        <template #item="{ item }">
          <div style="border: 1px solid #eee; padding: 1rem; margin-bottom: 1rem; border-radius: 4px;">
            <h3>{{ item.title }}</h3>
            <p>{{ item.description }}</p>
            <p><small><strong>Author:</strong> {{ Array.isArray(item.author) ? item.author.join(', ') : item.author }}</small></p>
            <p><small><strong>Published on:</strong> {{ item.date.toLocaleDateString() }}</small></p>
          </div>
        </template>
        <template #empty>
          <div style="padding: 2rem; text-align: center;">
            <p>No matching items found. Try clearing some filters.</p>
          </div>
        </template>
      </UluFacetsResults>
    </template>
  </UluFacetsSidebarLayout>
</template>
```

<h3 id="facetfields-api">facetFields API</h3>

The `useFacets` composable can automatically generate filter groups from a `facetFields` configuration array. Each object in the array defines a facet group and its behavior. Here are the available keys:

<table>
  <thead>
    <tr>
      <th>Key</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>uid</code></td>
      <td><code>String</code></td>
      <td><strong>Required</strong></td>
      <td>The property key on each item in your data array that holds the facet&#39;s value.</td>
    </tr>
    <tr>
      <td><code>name</code></td>
      <td><code>String</code></td>
      <td><strong>Required</strong></td>
      <td>The display name for the facet group, shown as a title in the UI.</td>
    </tr>
    <tr>
      <td><code>multiple</code></td>
      <td><code>Boolean</code></td>
      <td><code>false</code></td>
      <td>If <code>true</code>, allows multiple values to be selected (renders as checkboxes). If <code>false</code>,
        only one value can be selected (renders as radio buttons).</td>
    </tr>
    <tr>
      <td><code>open</code></td>
      <td><code>Boolean</code></td>
      <td><code>false</code></td>
      <td>If <code>true</code>, the facet group will be expanded by default in the UI.</td>
    </tr>
    <tr>
      <td><code>match</code></td>
      <td><code>String</code></td>
      <td><code>&#39;some&#39;</code></td>
      <td>Only applies when <code>multiple: true</code>. If set to <code>&#39;all&#39;</code>, items must match
        <strong>all</strong> selected values in the group (AND logic). The default is to match <strong>any</strong>
        value (OR logic).</td>
    </tr>
    <tr>
      <td><code>getValue</code></td>
      <td><code>Function</code></td>
      <td><code>item =&gt; item[uid]</code></td>
      <td>A function that receives an item and returns the value for the facet. Useful for derived or nested values
        (e.g., <code>item =&gt; item.date.getFullYear()</code>).</td>
    </tr>
    <tr>
      <td><code>getLabel</code></td>
      <td><code>Function</code></td>
      <td><code>value =&gt; value</code></td>
      <td>A function that receives a facet value and returns a formatted string for display. Useful for transforming
        values into more readable labels.</td>
    </tr>
  </tbody>
</table>