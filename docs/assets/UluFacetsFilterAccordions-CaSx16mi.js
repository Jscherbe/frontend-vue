import{ref as T,computed as x,watch as $,watchPostEffect as se,createBlock as q,openBlock as k,withCtx as C,createTextVNode as _,createElementBlock as P,createCommentVNode as K,toDisplayString as I,Fragment as ie,renderList as ce,createVNode as G,normalizeClass as re,renderSlot as le}from"vue";import oe from"fuse.js";import{_ as ue}from"./UluSelectableMenu-I83UynnH.js";import{_ as H}from"./UluAccordion-CWRRDQDz.js";function de(t){const y=new Set;for(const s of t)for(const i of s)y.add(i);return y}function B(t){if(!t||t.length===0)return new Set;const y=t.sort((i,m)=>i.size-m.size),s=new Set(y[0]);for(let i=1;i<y.length;i++){for(const m of s)y[i].has(m)||s.delete(m);if(s.size===0)break}return s}function O(t,y,s){if(!t||t.length===0)return s;const i=t.map(m=>{const h=m.children.map(l=>{const c=`${m.uid}:${l.uid}`;return y.get(c)||new Set});return m.match==="all"?B(h):de(h)});return B(i)}function fe(t,y){return!y||!Array.isArray(y)?[]:y.map(s=>{const i=new Set,m=s.getValue||(c=>c[s.uid]);t.forEach(c=>{const p=m(c);Array.isArray(p)?p.forEach(b=>b&&i.add(b)):p&&i.add(p)});const h=s.getLabel||(c=>c),l=[...i].map(c=>({uid:c,label:h(c),selected:!1}));return l.sort((c,p)=>String(c.label).localeCompare(String(p.label))),{...s,children:l}})}function be(t,y={}){const{initialFacets:s,facetFields:i,initialSearchValue:m="",initialSortType:h="az",noDefaultSorts:l=!1,extraSortTypes:c={},searchOptions:p={},getSortValue:b=e=>e.title||e.label||"",countMode:M="none",urlSync:L}=y,J=e=>e.sort((n,f)=>{const a=b(n),r=b(f);return a&&r?String(a).localeCompare(String(r)):a?-1:r?1:0}),Q={az:{text:"A-Z",sort:J},za:{text:"Z-A",sort:e=>J(e).reverse()}};function X(e){return(e||[]).map(n=>({...n,open:n.open||!1,children:n.children.map(f=>({...f,selected:f.selected||!1})),selectedCount:0}))}const v=T([]),E=T(m),A=T(h),Y=x(()=>!i||!t.value?.length?null:fe(t.value,i)),W=x(()=>({...l?{}:Q,...c})),j=x(()=>{const e=new Map,n=F.value;if(!n||!i)return e;const f=new Map(i.map(a=>{const r=a.getValue||(g=>g[a.uid]);return[a.uid,r]}));for(let a=0;a<n.length;a++){const r=n[a];for(const g of i){const o=f.get(g.uid)(r),d=Array.isArray(o)?o:o?[o]:[];for(const S of d){const U=`${g.uid}:${S}`;e.has(U)||e.set(U,new Set),e.get(U).add(a)}}}return e}),ee=x(()=>({shouldSort:!0,keys:["title","label","description","author"],...p})),F=x(()=>E.value?.length?new oe(t.value,ee.value).search(E.value).map(n=>n.item):t.value),N=x(()=>{const e=[];return v.value.forEach(n=>{const f=n.children.filter(a=>a.selected);f.length>0&&e.push({...n,children:f})}),e}),Z=x(()=>{if(!N.value.length)return F.value;const e=j.value;if(e.size===0&&F.value.length>0&&i?.length>0)return[];const n=new Set(F.value.map((r,g)=>g)),f=O(N.value,e,n),a=[];for(const r of f)a.push(F.value[r]);return a}),te=x(()=>{const e=W.value[A.value]?.sort;return typeof e!="function"?Z.value:e([...Z.value])});function ne(){v.value.forEach(e=>{e.children&&e.children.forEach(n=>n.selected=!1),e.selectedCount=0})}function R({groupUid:e,facetUid:n,selected:f}){const a=v.value.find(r=>r.uid===e);if(a){!a.multiple&&f&&a.children.forEach(g=>{g.uid!==n&&(g.selected=!1)});const r=a.children.find(g=>g.uid===n);r&&(r.selected=f),a.selectedCount=a.children.filter(g=>g.selected).length}}if($(Y,e=>{const n=X(s||e);n.forEach(f=>{f.selectedCount=f.children.filter(a=>a.selected).length}),v.value=n},{immediate:!0}),$([N,F],([e,n],[f,a])=>{if(!(M==="none"||!v.value.length)&&!(e===f&&n===a)){if(M==="simple"){const r=j.value;if(r.size===0&&F.value.length>0&&i?.length>0)return;const g=new Set(F.value.map((u,o)=>o));v.value.forEach(u=>{const o=e.filter(S=>S.uid!==u.uid),d=O(o,r,g);u.children.forEach(S=>{const U=`${u.uid}:${S.uid}`,V=r.get(U)||new Set,w=B([d,V]);S.count=w.size})})}else if(M==="intuitive"){const r=j.value;if(r.size===0&&F.value.length>0&&i?.length>0)return;const g=new Set(F.value.map((o,d)=>d)),u=O(e,r,g);v.value.forEach(o=>{o.children.forEach(d=>{const S=`${o.uid}:${d.uid}`,U=r.get(S)||new Set;if(d.selected)if(o.multiple){const V=B([u,U]);d.count=V.size}else d.count=u.size;else{const V=[];for(const z of e)V.push({...z,children:[...z.children]});let w=V.find(z=>z.uid===o.uid);w||(w={...o,children:[]},V.push(w)),o.multiple?w.children.push(d):w.children=[d];const ae=O(V,r,g);d.count=ae.size}})})}}},{deep:!0,immediate:!0}),L?.router&&L?.route){const{router:e,route:n}=L,f=()=>v.value&&v.value.length>0,a=()=>{if(!f())return;const u={...n.query};delete u.sort,delete u.search,v.value.forEach(o=>delete u[o.uid]),A.value&&A.value!==h&&(u.sort=A.value),E.value&&(u.search=E.value),N.value.forEach(o=>{o.children.length>0&&(u[o.uid]=o.children.map(d=>d.uid).join(","))}),JSON.stringify(u)!==JSON.stringify(n.query)&&e.push({query:u})},r=()=>{const u=n.query;u.sort&&(A.value=u.sort),u.search&&(E.value=u.search);const o=new Map;v.value.forEach(d=>{const S=u[d.uid]?u[d.uid].split(","):[];o.set(d.uid,new Set(S))}),v.value.forEach(d=>{const S=o.get(d.uid)||new Set;d.children.forEach(U=>{const V=U.selected,w=S.has(U.uid);V!==w&&R({groupUid:d.uid,facetUid:U.uid,selected:w})})})},g=se(()=>{v.value&&v.value.length>0&&(r(),g())});$([A,E,N],a,{deep:!0}),$(()=>n.query,r)}return{facets:v,searchValue:E,selectedSort:A,sortTypes:W,displayItems:te,selectedFacets:N,clearFilters:ne,handleFacetChange:R}}const me={key:0},D={__name:"UluFacetsList",props:{groupUid:String,groupName:String,children:Array,type:{type:String,default:"checkbox"},compact:Boolean,modelValue:[String,Array]},emits:["facet-change"],setup(t,{emit:y}){const s=t,i=y,m=x(()=>s.type==="radio"?[{label:`All ${s.groupName}s`,uid:""},...s.children]:s.children);function h(l){if(s.type==="radio"){const c=l;s.children.forEach(p=>{const b=p.uid===c;p.selected!==b&&i("facet-change",{groupUid:s.groupUid,facetUid:p.uid,selected:b})})}else{const c=new Set(l);s.children.forEach(p=>{const b=c.has(p.uid);p.selected!==b&&i("facet-change",{groupUid:s.groupUid,facetUid:p.uid,selected:b})})}}return(l,c)=>(k(),q(ue,{class:"facets-list",legend:t.groupUid,type:t.type,options:m.value,compact:t.compact,"model-value":t.modelValue,"onUpdate:modelValue":h},{default:C(({option:p})=>[_(I(p.label)+" ",1),p.count!==void 0?(k(),P("span",me,"("+I(p.count)+")",1)):K("",!0)]),_:1},8,["legend","type","options","compact","model-value"]))}};D.__docgenInfo={exportName:"default",displayName:"UluFacetsList",description:"",tags:{},props:[{name:"groupUid",type:{name:"string"}},{name:"groupName",type:{name:"string"}},{name:"children",type:{name:"array"}},{name:"type",type:{name:"string"},defaultValue:{func:!1,value:"'checkbox'"}},{name:"compact",type:{name:"boolean"}},{name:"modelValue",type:{name:"string|array"}}],events:[{name:"facet-change"}],sourceFiles:["/Users/joescherben/Personal/Projects/ULU/frontend-vue/lib/components/systems/facets/UluFacetsList.vue"]};const he={class:"facets-filters"},pe={__name:"UluFacetsFilterAccordions",props:{classes:{type:Object,default:()=>({})},maxVisible:{type:Number,default:5},facets:{type:Array,default:()=>[]},compact:Boolean,accordionModifiers:[String,Array]},emits:["facet-change"],setup(t,{emit:y}){const s=y,i=m=>m.multiple?m.children.filter(h=>h.selected).map(h=>h.uid):m.children.find(h=>h.selected)?.uid||"";return(m,h)=>(k(),P("div",he,[(k(!0),P(ie,null,ce(t.facets,l=>(k(),q(H,{key:l.uid,modifiers:t.accordionModifiers,startOpen:l.open},{trigger:C(({isOpen:c})=>[le(m.$slots,"groupTrigger",{group:l,isOpen:c},()=>[_(I(l.name),1)])]),default:C(()=>[G(D,{children:l.children.slice(0,t.maxVisible),groupUid:l.uid,groupName:l.name,type:l.multiple?"checkbox":"radio",compact:t.compact,"model-value":i(l),onFacetChange:h[0]||(h[0]=c=>s("facet-change",c))},null,8,["children","groupUid","groupName","type","compact","model-value"]),l.children.length>t.maxVisible?(k(),q(H,{key:0,class:re(["facets-filters__more-facets",t.classes.moreFacets]),modifiers:t.accordionModifiers},{trigger:C(({isOpen:c})=>[_(I(c?"View Less":"Show More"),1)]),default:C(()=>[G(D,{children:l.children.slice(t.maxVisible),groupUid:l.uid,groupName:l.name,type:l.multiple?"checkbox":"radio",compact:t.compact,"model-value":i(l),onFacetChange:h[1]||(h[1]=c=>s("facet-change",c))},null,8,["children","groupUid","groupName","type","compact","model-value"])]),_:2},1032,["class","modifiers"])):K("",!0)]),_:2},1032,["modifiers","startOpen"]))),128))]))}};pe.__docgenInfo={exportName:"default",displayName:"UluFacetsFilterAccordions",description:"",tags:{},props:[{name:"classes",description:"An object of classes to apply to the component.",type:{name:"object"},defaultValue:{func:!1,value:"{}"}},{name:"maxVisible",description:'The maximum number of facets to show before showing the "More" button.',type:{name:"number"},defaultValue:{func:!1,value:"5"}},{name:"facets",description:"An array of facet groups to display.",type:{name:"array"},defaultValue:{func:!1,value:"[]"}},{name:"compact",description:"Whether to use compact modifier on selectable menu",type:{name:"boolean"}},{name:"accordionModifiers",description:"Class modifiers for accordion (ie. 'transparent', 'secondary', etc)",type:{name:"string|array"}}],events:[{name:"facet-change"}],slots:[{name:"groupTrigger",scoped:!0,bindings:[{name:"group",title:"binding"},{name:"isOpen",title:"binding"}]}],sourceFiles:["/Users/joescherben/Personal/Projects/ULU/frontend-vue/lib/components/systems/facets/UluFacetsFilterAccordions.vue"]};export{pe as _,D as a,be as u};
